{"inject_files": [{"path": "/etc/vm_monitor/send_monitor_data.py", "contents": "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uCgonJycKQ3JlYXRlZCBvbiAyMDEyLTA3LTIzClVwZGF0ZWQgb24gMjAxMy0wNy0xMgoKQGF1dGhvcjogaHp5YW5ndGtAY29ycC5uZXRlYXNlLmNvbQonJycKCmltcG9ydCBmY250bAppbXBvcnQgaGFzaGxpYgppbXBvcnQgaG1hYwppbXBvcnQgaHR0cGxpYgppbXBvcnQganNvbgppbXBvcnQgb3MKaW1wb3J0IHNvY2tldAppbXBvcnQgc3RydWN0CmltcG9ydCB0aW1lCmltcG9ydCB1cmxsaWIKZnJvbSB4bWwuZXRyZWUgaW1wb3J0IEVsZW1lbnRUcmVlCgoKUEVSSU9EX1RJTUUgPSA2MApNT05JVE9SX1BBVEggPSAnL2V0Yy92bV9tb25pdG9yLycKSU5GT19QQVRIID0gTU9OSVRPUl9QQVRIICsgJ2luZm8nClRFTVBfUEFUSCA9IE1PTklUT1JfUEFUSCArICd0ZW1wJwpYTUxfUEFUSCA9IE1PTklUT1JfUEFUSCArICdtb25pdG9yX3NldHRpbmdzLnhtbCcKTUVUQV9QQVRIID0gTU9OSVRPUl9QQVRIICsgJ21ldGFkYXRhJwpURU1QX0RBVEEgPSB7CiAgICAgICAgICAgICAndG90YWxfY3B1X3RpbWUnOiAwLAogICAgICAgICAgICAgJ2xhc3RfY3B1X2lkbGVfdGltZSc6IDAsCiAgICAgICAgICAgICAnZGlza19yZWFkX3JlcXVlc3QnOiAwLAogICAgICAgICAgICAgJ2Rpc2tfd3JpdGVfcmVxdWVzdCc6IDAsCiAgICAgICAgICAgICAnZGlza19yZWFkJzogMCwKICAgICAgICAgICAgICdkaXNrX3dyaXRlJzogMCwKICAgICAgICAgICAgICdkaXNrX3JlYWRfZGVsYXknOiAwLAogICAgICAgICAgICAgJ2Rpc2tfd3JpdGVfZGVsYXknOiAwLAogICAgICAgICAgICAgJ25ldHdvcmtfcmVjZWl2ZV9ieXRlcyc6IDAsCiAgICAgICAgICAgICAnbmV0d29ya190cmFuc2Zlcl9ieXRlcyc6IDAsCiAgICAgICAgICAgICAnZGlza19wYXJ0aXRpb25faW5mbyc6IHt9LAogICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IDAKfQpFTkFCTEVfUEFSVElUSU9OX01PTklUT1IgPSBUcnVlCk5FVF9DQVJEX0xJU1QgPSBbJ2V0aDAnLCBdClNFUlZJQ0VfTElTVCA9IFsnb3BlbnN0YWNrJywgJ05WUycsICdOUVMnXQoKCmRlZiBnZXRfb3JpX3VzZXIoKToKICAgICcnJwogICAgICAgIEdldCBwcm9qZWN0IGlkIG9mIHRoaXMgdmlydHVhbCBtYWNoaW5lCiAgICAnJycKICAgIGlmIG9zLnBhdGguZXhpc3RzKE1FVEFfUEFUSCk6CiAgICAgICAgbWV0YV9maWxlX3JlYWQgPSBvcGVuKE1FVEFfUEFUSCwgJ3InKQogICAgICAgIHRlbXAgPSBtZXRhX2ZpbGVfcmVhZC5yZWFkKCkKICAgICAgICBtZXRhX2ZpbGVfcmVhZC5jbG9zZSgpCiAgICAgICAgaWYgdGVtcDoKICAgICAgICAgICAgbWV0YWRhdGEgPSBqc29uLmxvYWRzKHRlbXApCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCkKICAgIGVsc2U6CiAgICAgICAgbWV0YWRhdGEgPSBnZXRfbWV0YWRhdGFfZnJvbV9ub3ZhKCkKICAgICAgICBzdG9yZV9tZXRhZGF0YShtZXRhZGF0YSkKICAgIG9yaV91c2VyID0gbWV0YWRhdGEuZ2V0KCdwcm9qZWN0X2lkJykKICAgIGlmIG9yaV91c2VyIGlzIE5vbmU6CiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCkKICAgIHJldHVybiBvcmlfdXNlcgoKCmRlZiBnZXRfbWV0YWRhdGFfZnJvbV9ub3ZhKCk6CiAgICAnJycKICAgICAgICBDYWxsIG5vdmEgYXBpIHRvIGdldCB2bSBtZXRhZGF0YS4KICAgICcnJwogICAgdXJsID0gJzE2OS4yNTQuMTY5LjI1NCcKICAgIGh0dHBNZXRob2QgPSAnR0VUJwogICAgcmVxdWVzdFVSSSA9ICcvb3BlbnN0YWNrL2xhdGVzdC9tZXRhX2RhdGEuanNvbicKICAgIGhlYWRlcnMgPSB7J0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfQogICAgY29ubiA9IGh0dHBsaWIuSFRUUENvbm5lY3Rpb24odXJsKQogICAgY29ubi5yZXF1ZXN0KGh0dHBNZXRob2QsIHJlcXVlc3RVUkksICcnLCBoZWFkZXJzKQogICAgcmVzcG9uc2UgPSBjb25uLmdldHJlc3BvbnNlKCkKICAgIG1ldGFfZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQogICAgY29ubi5jbG9zZSgpCiAgICBpZiByZXNwb25zZS5zdGF0dXMgIT0gMjAwOgogICAgICAgIHJhaXNlIEV4Y2VwdGlvbigpCiAgICBtZXRhX2RhdGFfZGljdCA9IGpzb24ubG9hZHMobWV0YV9kYXRhKQogICAgcmV0dXJuIG1ldGFfZGF0YV9kaWN0CgoKZGVmIGdldF91dWlkKCk6CiAgICAnJycKICAgICAgICBHZXQgdXVpZCBvZiB0aGlzIHZpcnR1YWwgbWFjaGluZQogICAgJycnCiAgICAjIE5PVEUoaHpyYW5kZCk6IHNob3VsZCBnZXQgbWV0YWRhdGEgaW5mb3JtYXRpb24gZnJvbSBub3ZhIGV2ZXJ5IHRpbWUuCiAgICBtZXRhZGF0YSA9IGdldF9tZXRhZGF0YV9mcm9tX25vdmEoKQogICAgc3RvcmVfbWV0YWRhdGEobWV0YWRhdGEpCiAgICB1dWlkID0gbWV0YWRhdGEuZ2V0KCd1dWlkJykKICAgIGlmIHV1aWQgaXMgTm9uZToKICAgICAgICByYWlzZSBFeGNlcHRpb24oKQogICAgcmV0dXJuIHV1aWQKCgpkZWYgc3RvcmVfbWV0YWRhdGEobWV0YWRhdGEpOgogICAgbWV0YV9maWxlX3dyaXRlID0gb3BlbihNRVRBX1BBVEgsICd3JykKICAgIHRyeToKICAgICAgICBqc29uYSA9IGpzb24uZHVtcHMobWV0YWRhdGEpCiAgICAgICAgbWV0YV9maWxlX3dyaXRlLndyaXRlKGpzb25hKQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAjIE5PVEUoaHp5YW5ndGspOiB3aGVuIGV4Y2VwdGlvbiBoYXBwZW5zIHJhaXNlIGl0LCBzdG9wIHNlbmRpbmcgZGF0YXMuCiAgICAgICAgcmFpc2UKICAgIGZpbmFsbHk6CiAgICAgICAgbWV0YV9maWxlX3dyaXRlLmNsb3NlKCkKCgpkZWYgcmVhZF9pbmZvX2ZpbGUoKToKICAgICcnJwogICAgICAgIFJlYWQgY29uZmlnIGluZm8gZnJvbSBsb2NhbCBmaWxlLCBkZWZhdWx0IHBhdGg6IC9ldGMvdm1fbW9uaXRvci9pbmZvCiAgICAnJycKICAgIHdpdGggb3BlbihJTkZPX1BBVEgsICdyJykgYXMgaW5mb19maWxlOgogICAgICAgIGRhdGFfZnJvbV9maWxlID0gaW5mb19maWxlLnJlYWQoKQogICAgbWV0YWRhdGFfZGljdCA9IGpzb24ubG9hZHMoZGF0YV9mcm9tX2ZpbGUpCiAgICByZXR1cm4gbWV0YWRhdGFfZGljdAoKCiMKIyAgICBVc2UgdGVtcCBmaWxlIHRvIHN0b3JlIGxhc3QgbWludXRlIGRhdGEuCiMgICAgZGVmYXVsdCBwYXRoOiAvZXRjL3ZtX21vbml0b3IvdGVtcAojCmRlZiBjaGVja190ZW1wX2V4cGlyZWQodGVtcF90aW1lc3RhbXApOgogICAgcGVyaW9kID0gbG9uZyh0aW1lLnRpbWUoKSkgLSB0ZW1wX3RpbWVzdGFtcAogICAgaWYgcGVyaW9kID49IDAgYW5kIHBlcmlvZCA8PSBQRVJJT0RfVElNRSArIDMwOgogICAgICAgIHJldHVybiBGYWxzZQogICAgZWxzZToKICAgICAgICByZXR1cm4gVHJ1ZQoKCmRlZiByZWFkX3RlbXBfZmlsZSgpOgogICAgJycnCiAgICAgICAgV2hlbiBtb25pdG9yIHN0YXJ0IGl0IHdpbGwgcmVhZCB0ZW1wIGZpbGUgd2hpY2ggaGFzIHN0b3JlZCBkYXRhcwogICAgICAgIGxhc3QgMSBtaW51dGUgYWdvLgogICAgICAgIFdoZW4gbGFzdCB0aW1lc3RhbXAgaXMgbm90IGluIDF+OTAgc2Vjb25kcywgaXQKICAgICAgICBtZWFucyB0ZW1wIGZpbGUgaXMgZXhwaXJlZC4gVGhlIGRhdGEgaW4gdGVtcCBmaWxlCiAgICAgICAgc2hvdWxkIGJlIHJlY29yZCBhZ2Fpbi4KICAgICAgICBAcmV0dXJuOiBUcnVlL0ZhbHNlCiAgICAnJycKICAgIHRyeToKICAgICAgICBnbG9iYWwgVEVNUF9EQVRBCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoVEVNUF9QQVRIKToKICAgICAgICAgICAgdGVtcF9maWxlX3JlYWQgPSBvcGVuKFRFTVBfUEFUSCwgJ3InKQogICAgICAgICAgICB0ZW1wZGF0YSA9IHRlbXBfZmlsZV9yZWFkLnJlYWQoKQogICAgICAgICAgICB0ZW1wX2ZpbGVfcmVhZC5jbG9zZSgpCiAgICAgICAgICAgIGlmIHRlbXBkYXRhOgogICAgICAgICAgICAgICAgdGVtcF9kYXRhID0ganNvbi5sb2Fkcyh0ZW1wZGF0YSkKICAgICAgICAgICAgICAgIGlzX2V4cGlyZWQgPSBjaGVja190ZW1wX2V4cGlyZWQodGVtcF9kYXRhWyd0aW1lc3RhbXAnXSkKICAgICAgICAgICAgICAgIGlmIG5vdCBpc19leHBpcmVkOgogICAgICAgICAgICAgICAgICAgIGZvciBrZXkgaW4gdGVtcF9kYXRhLmtleXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYga2V5IGluIFRFTVBfREFUQToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRFTVBfREFUQVtrZXldID0gdGVtcF9kYXRhW2tleV0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIHJldHVybiBGYWxzZQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAjIE5PVEUoaHp5YW5ndGspOiB3aGVuIGV4Y2VwdGlvbiBoYXBwZW5zLCByZXR1cm4gRmFsc2UKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgd3JpdGVfdGVtcF9maWxlKCk6CiAgICAnJycKICAgICAgICBXaGVuIG1vbml0b3IgY2F0Y2ggdGhlIG5ld2VzdCBkYXRhcywgaXQgd2lsbCBzdG9yZSB0aGVtCiAgICAgICAgaW50byB0ZW1wIGZpbGUuCiAgICAgICAgSXQgd2lsbCByZWNvcmQgdGltZXN0YW1wIGludG8gdGVtcCBmaWxlIGZvciBtYXJrIHRoZSB0ZW1wCiAgICAgICAgZmlsZSBpcyBleHBpcmVkIG9yIG5vdC4KICAgICAgICBAcmFpc2UgZXhjZXB0aW9uOiBFeGNlcHRpb24KICAgICcnJwogICAgdHJ5OgogICAgICAgIHRlbXBfZmlsZV93cml0ZSA9IG9wZW4oVEVNUF9QQVRILCAndycpCiAgICAgICAgVEVNUF9EQVRBWyd0aW1lc3RhbXAnXSA9IGxvbmcodGltZS50aW1lKCkpCiAgICAgICAganNvbmEgPSBqc29uLmR1bXBzKFRFTVBfREFUQSkKICAgICAgICB0ZW1wX2ZpbGVfd3JpdGUud3JpdGUoanNvbmEpCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICMgTk9URShoenlhbmd0ayk6IHdoZW4gZXhjZXB0aW9uIGhhcHBlbnMgcmFpc2UgaXQsIHN0b3Agc2VuZGluZyBkYXRhcy4KICAgICAgICByYWlzZQogICAgZmluYWxseToKICAgICAgICB0ZW1wX2ZpbGVfd3JpdGUuY2xvc2UoKQoKCmRlZiBoYW5kbGVfbWV0YWRhdGEobWV0YWRhdGFfZGljdCk6CiAgICBzZXJ2aWNlID0gbWV0YWRhdGFfZGljdC5nZXQoJ3NlcnZpY2UnKQogICAgb3JpX3VzZXIgPSBtZXRhZGF0YV9kaWN0LmdldCgnb3JpX3VzZXInLCAnJykKICAgIGFnZ3JlZ2F0aW9uX2l0ZW1zID0gbWV0YWRhdGFfZGljdC5nZXQoJ2FnZ3JlZ2F0aW9uX2l0ZW1zJykKICAgIHJlc291cmNlX3R5cGUgPSBtZXRhZGF0YV9kaWN0LmdldCgncmVzb3VyY2VfdHlwZScpCiAgICBpZiBvcmlfdXNlciA9PSAnJyBhbmQgc2VydmljZSA9PSAnb3BlbnN0YWNrJzoKICAgICAgICBtZXRhZGF0YV9kaWN0WydvcmlfdXNlciddID0gZ2V0X29yaV91c2VyKCkKICAgIGlmIGFnZ3JlZ2F0aW9uX2l0ZW1zID09IE5vbmUgb3IgYWdncmVnYXRpb25faXRlbXMgPT0gJyc6CiAgICAgICAgbWV0YWRhdGFfZGljdFsnYWdncmVnYXRpb25faXRlbXMnXSA9IHt9CiAgICBpZiBzZXJ2aWNlID09ICdvcGVuc3RhY2snIGFuZCByZXNvdXJjZV90eXBlICE9ICdvcGVuc3RhY2snOgogICAgICAgIG1ldGFkYXRhX2RpY3RbJ3Jlc291cmNlX3R5cGUnXSA9ICdvcGVuc3RhY2snCiAgICByZXR1cm4gVHJ1ZQoKCmRlZiBub3RpZnlfcGxhdGZvcm1fcGFydGl0aW9uX2NoYW5nZShkaXNrX3BhcnRpdGlvbl9pbmZvKToKICAgICcnJwogICAgICAgIG5vdGlmeSBwbGF0Zm9ybSB3aGVuIHBhcnRpdGlvbiBjaGFuZ2VkIG9ubHkgd2hlbiBzZXJ2aWNlIHN1cHBvcnRzCiAgICAgICAgZGlza1BhcnRpdGlvbiBtZXRyaWMuCgogICAgICAgIDpwYXJhbSBkaXNrX3BhcnRpdGlvbl9pbmZvOiB7J3N5cyc6Wyd2ZGExJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9naWMnOlsndmRhMScsICd2ZGIxJywgJ2RtLTAnXX0KICAgICcnJwogICAgdHJ5OgogICAgICAgIG1ldGFkYXRhX2RpY3QgPSByZWFkX2luZm9fZmlsZSgpCiAgICAgICAgc2VydmljZSA9IG1ldGFkYXRhX2RpY3QuZ2V0KCdzZXJ2aWNlJykKICAgICAgICByZXNvdXJjZV90eXBlID0gbWV0YWRhdGFfZGljdC5nZXQoJ3Jlc291cmNlX3R5cGUnKQogICAgICAgIHNldHRpbmdfcm9vdCA9IEVsZW1lbnRUcmVlLnBhcnNlKFhNTF9QQVRIKQogICAgICAgIHNldHRpbmdfc2VydmljZXMgPSBzZXR0aW5nX3Jvb3QuZmluZGFsbCgnc2VydmljZScpCiAgICAgICAgbWV0cmljX3R5cGVzID0gW10KICAgICAgICBmb3IgcyBpbiBzZXR0aW5nX3NlcnZpY2VzOgogICAgICAgICAgICBpZiAoc2VydmljZSA9PSBzLmF0dHJpYi5nZXQoJ25hbWUnKSBhbmQKICAgICAgICAgICAgICAgICAgICByZXNvdXJjZV90eXBlID09IHMuYXR0cmliLmdldCgncmVzb3VyY2VfdHlwZScpKToKICAgICAgICAgICAgICAgIG1ldHJpY190eXBlcyA9IHMuZmluZGFsbCgnbWV0cmljJykKCiAgICAgICAgbWV0cmljcyA9IFttLmF0dHJpYi5nZXQoJ25hbWUnKSBmb3IgbSBpbiBtZXRyaWNfdHlwZXNdCiAgICAgICAgaWYgJ2Rpc2tQYXJ0aXRpb24nIG5vdCBpbiBtZXRyaWNzOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgcmVxdWVzdF91cmkgPSAnL3Jlc3QvVjEvbnZzL3VwZGF0ZVBhcnRpdGlvbkluZm8nCiAgICAgICAgc3lzdGVtX3BhcnRpdGlvbnMgPSAnLCcuam9pbihkaXNrX3BhcnRpdGlvbl9pbmZvWydzeXMnXSkKICAgICAgICBsb2dpY19wYXJ0aXRpb25zID0gJywnLmpvaW4oZGlza19wYXJ0aXRpb25faW5mb1snbG9naWMnXSkKICAgICAgICAjIHBhcnRpdGlvbiBkaW1lbnNpb24gaXMgbGlrZSBvcGVuc3RhY2s9MS4xLjEuMSBvciBSRFM9MTIzNDU2CiAgICAgICAgcGFydGlfZGltZW5zaW9uID0gbWV0YWRhdGFfZGljdC5nZXQoJ3NlcnZpY2UnKSArICc9JyArIGdldF91dWlkKCkKICAgICAgICBzZW5kX3JlcXVlc3QgPSBTZW5kUmVxdWVzdChtZXRhZGF0YV9kaWN0PW1ldGFkYXRhX2RpY3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdF91cmk9cmVxdWVzdF91cmksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzdGVtX3BhcnRpdGlvbnM9c3lzdGVtX3BhcnRpdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9naWNfcGFydGl0aW9ucz1sb2dpY19wYXJ0aXRpb25zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpX2RpbWVuc2lvbj1wYXJ0aV9kaW1lbnNpb24pCiAgICAgICAgcmVzcG9uc2UgPSBzZW5kX3JlcXVlc3Quc2VuZF9yZXF1ZXN0X3RvX3NlcnZlcigpCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzID09IDIwMDoKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcmV0dXJuIEZhbHNlCgoKY2xhc3MgR2V0U3lzdGVtVXNhZ2Uob2JqZWN0KToKICAgICcnJwogICAgICAgIEdldCBzeXN0ZW0gcmVzb3VyY2VzIHVzYWdlIGluY2x1ZGUgZGlzaywgbmV0d29yaywgY3B1LCBtZW1vcnkuCiAgICAgICAgQ1BVOiBnZXQgY3B1IHVzYWdlIHBlcmNlbnQuCiAgICAgICAgTWVtb3J5OiBnZXQgdG90YWwgbWVtb3J5KEtCKSwgZnJlZSBtZW1vcnkgYW5kIHVzZWQgbWVtb3J5IGRhdGFzLgogICAgICAgIERpc2s6IGdldCBkaXNrIHJlYWQvd3JpdGUgZGF0YSgoS0IpKSwgcmVxdWVzdHMgYW5kIHVzZWQgZGVsYXkobXMpLgogICAgICAgIE5ldHdvcms6IGdldCBuZXR3b3JrIEkvTyBkYXRhcyhieXRlcykgYW5kIHZtIGlwLgogICAgJycnCiAgICBkZWYgX2dldF9jcHVfdXNhZ2VfZGljdChzZWxmKToKICAgICAgICAnJycKICAgICAgICAgICAgR2V0IENQVSB1c2FnZShwZXJjZW50KSBieSB2bXN0YXQgY29tbWFuZC4KICAgICAgICAgICAgQHJldHVybjogeydjcHVfdXNhZ2UnOiAwLjB9CiAgICAgICAgJycnCiAgICAgICAgY3B1X3BhdGggPSAnL3Byb2Mvc3RhdCcKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhjcHVfcGF0aCk6CiAgICAgICAgICAgIGNwdV9maWxlX3JlYWQgPSBvcGVuKGNwdV9wYXRoLCAncicpCiAgICAgICAgICAgIGNwdV9yZWFkX2xpbmUgPSBjcHVfZmlsZV9yZWFkLnJlYWRsaW5lKCkKICAgICAgICAgICAgY3B1X2ZpbGVfcmVhZC5jbG9zZSgpCiAgICAgICAgICAgIGNwdV9pbmZvcyA9IGNwdV9yZWFkX2xpbmUuc3BsaXQoKVsxOi0xXQogICAgICAgICAgICB0b3RhbF9jcHVfdGltZSA9IDBMCiAgICAgICAgICAgIGZvciBjcHVfaW5mbyBpbiBjcHVfaW5mb3M6CiAgICAgICAgICAgICAgICB0b3RhbF9jcHVfdGltZSArPSBsb25nKGNwdV9pbmZvKQogICAgICAgICAgICBsYXN0X2NwdV90aW1lID0gVEVNUF9EQVRBWyd0b3RhbF9jcHVfdGltZSddCiAgICAgICAgICAgIGNwdV9pZGxlX3RpbWUgPSBsb25nKGNwdV9pbmZvc1szXSkKICAgICAgICAgICAgbGFzdF9jcHVfaWRsZV90aW1lID0gVEVNUF9EQVRBWydsYXN0X2NwdV9pZGxlX3RpbWUnXQogICAgICAgICAgICB0b3RhbF9jcHVfcGVyaW9kID0gZmxvYXQodG90YWxfY3B1X3RpbWUgLSBsYXN0X2NwdV90aW1lKQogICAgICAgICAgICBpZGxlX2NwdV9wZXJpb2QgPSBmbG9hdChjcHVfaWRsZV90aW1lIC0gbGFzdF9jcHVfaWRsZV90aW1lKQoKICAgICAgICAgICAgaWYgdG90YWxfY3B1X3BlcmlvZCA8PSAwIG9yIGlkbGVfY3B1X3BlcmlvZCA8IDA6CiAgICAgICAgICAgICAgICBjcHVfdXNhZ2UgPSAwLjAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlkbGVfdXNhZ2UgPSBpZGxlX2NwdV9wZXJpb2QgLyB0b3RhbF9jcHVfcGVyaW9kICogMTAwCiAgICAgICAgICAgICAgICBjcHVfdXNhZ2UgPSByb3VuZCgxMDAgLSBpZGxlX3VzYWdlLCAyKQoKICAgICAgICAgICAgVEVNUF9EQVRBWyd0b3RhbF9jcHVfdGltZSddID0gdG90YWxfY3B1X3RpbWUKICAgICAgICAgICAgVEVNUF9EQVRBWydsYXN0X2NwdV9pZGxlX3RpbWUnXSA9IGNwdV9pZGxlX3RpbWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBjcHVfdXNhZ2UgPSAwLjAKICAgICAgICByZXR1cm4geydjcHVfdXNhZ2UnOiBjcHVfdXNhZ2V9CgogICAgZGVmIF9nZXRfbG9hZGF2Z19kaWN0KHNlbGYpOgogICAgICAgICcnJwogICAgICAgICAgICBHZXQgbG9hZGF2ZyBpbmZvIGZyb20gL3Byb2MvbG9hZGF2Zy4KICAgICAgICAgICAgQHJldHVybjogeydsb2FkYXZnXzUnOiA0LjMyfQogICAgICAgICcnJwogICAgICAgIHdpdGggb3BlbignL3Byb2MvbG9hZGF2ZycsICdyJykgYXMgbG9hZGF2Z19maWxlX3JlYWQ6CiAgICAgICAgICAgIGxvYWRhdmdfaW5mb19saW5lID0gbG9hZGF2Z19maWxlX3JlYWQucmVhZGxpbmUoKQogICAgICAgIGxvYWRhdmdfNSA9IGZsb2F0KGxvYWRhdmdfaW5mb19saW5lLnNwbGl0KClbMV0pCgogICAgICAgIHJldHVybiB7J2xvYWRhdmdfNSc6IGxvYWRhdmdfNX0KCiAgICBkZWYgX2dldF9tZW1vcnlfdXNhZ2VfZGljdChzZWxmKToKICAgICAgICAnJycKICAgICAgICAgICAgR2V0IG1lbW9yeSBpbmZvKE1CKSBmcm9tIC9wcm9jL21lbWluZm8uCiAgICAgICAgICAgIEByZXR1cm46IHsndG90YWxfbWVtb3J5JzogMSwgJ2ZyZWVfbWVtb3J5JzogMSwKICAgICAgICAgICAgICAgICAgICAgICd1c2VkX21lbW9yeSc6IDEsICdtZW1vcnlfdXNhZ2VfcmF0ZSc6IDQ1fQogICAgICAgICAgICBmcmVlX21lbW9yeSA9IE1lbUZyZWUgKyBCdWZmZXJzICsgQ2FjaGVkCiAgICAgICAgICAgIHVzZWRfbWVtb3J5ID0gTWVtVG90YWwgLSBmcmVlX21lbW9yeQogICAgICAgICAgICBtZW1vcnlfdXNhZ2VfcmF0ZSA9IHVzZWRfbWVtb3J5ICogMTAwIC8gTWVtVG90YWwKICAgICAgICAnJycKICAgICAgICB3aXRoIG9wZW4oJy9wcm9jL21lbWluZm8nLCAncicpIGFzIG1lbV9maWxlX3JlYWQ6CiAgICAgICAgICAgIG1lbV9pbmZvX2xpbmVzID0gbWVtX2ZpbGVfcmVhZC5yZWFkbGluZXMoKQoKICAgICAgICB0b3RhbF9tZW1vcnkgPSBsb25nKG1lbV9pbmZvX2xpbmVzWzBdLnNwbGl0KClbMV0pIC8gMTAyNAogICAgICAgIGZyZWVfbWVtb3J5ID0gKGxvbmcobWVtX2luZm9fbGluZXNbMV0uc3BsaXQoKVsxXSkKICAgICAgICAgICAgICAgICAgICAgICArIGxvbmcobWVtX2luZm9fbGluZXNbMl0uc3BsaXQoKVsxXSkKICAgICAgICAgICAgICAgICAgICAgICArIGxvbmcobWVtX2luZm9fbGluZXNbM10uc3BsaXQoKVsxXSkpIC8gMTAyNAogICAgICAgIHVzZWRfbWVtb3J5ID0gdG90YWxfbWVtb3J5IC0gZnJlZV9tZW1vcnkKICAgICAgICBtZW1vcnlfdXNhZ2VfcmF0ZSA9ICh1c2VkX21lbW9yeSAqIDEwMCkgLyB0b3RhbF9tZW1vcnkKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3RvdGFsX21lbW9yeSc6IHRvdGFsX21lbW9yeSwKICAgICAgICAgICAgJ2ZyZWVfbWVtb3J5JzogZnJlZV9tZW1vcnksCiAgICAgICAgICAgICd1c2VkX21lbW9yeSc6IHVzZWRfbWVtb3J5LAogICAgICAgICAgICAnbWVtb3J5X3VzYWdlX3JhdGUnOiBtZW1vcnlfdXNhZ2VfcmF0ZQogICAgICAgIH0KCiAgICBkZWYgX2dldF9kaXNrX2RhdGEoc2VsZik6CiAgICAgICAgJycnCiAgICAgICAgICAgIFVzZSBjb21tYW5kIGRmIHRvIGdldCBhbGwgcGFydGl0aW9uc2AgdXNlZC9hdmFpbGFibGUgZGlzawogICAgICAgICAgICBkYXRhcyhNQikuCiAgICAgICAgICAgIEZpbmQgc3RyaW5nIHN0YXJ0IHdpdGggJy9kZXYvJyBhbmQgc3BsaXQgaXQgd2l0aCAnLycgdG8gZ2V0CiAgICAgICAgICAgIGRpc2tzYCBuYW1lIGludG8gZGljdCBkaXNrcy4gTGlrZSAnL2Rldi92ZGExJyB0byBnZXQgJ3ZkYScuCiAgICAgICAgICAgIENhbGwgX2dldF9kaXNrX2RhdGFfYnlfcHJvYygpIHRvIGdldCBkYXRhcyBmcm9tIC9wcm9jL2Rpc2tzdGF0cy4KICAgICAgICAgICAgQHJldHVybjogewogICAgICAgICAgICAgICAgICAgICAgJ2Rpc2tfcmVhZF9yZXF1ZXN0JzogMCwgJ2Rpc2tfd3JpdGVfcmVxdWVzdCc6IDAsCiAgICAgICAgICAgICAgICAgICAgICAnZGlza19yZWFkJzogMCwgJ2Rpc2tfd3JpdGUnOiAwLCAnZGlza19yZWFkX2RlbGF5JzogMSwKICAgICAgICAgICAgICAgICAgICAgICdkaXNrX3dyaXRlX2RlbGF5JzogMSwgJ3VzZWRfZGlzayc6IDAsCiAgICAgICAgICAgICAgICAgICAgICAnYXZhaWxfZGlzayc6IDAsCiAgICAgICAgICAgICAgICAgICAgICAnZGlza19wYXJ0aXRpb25faW5mbyc6IHsnc3lzJzogWyd2ZGExJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbG9naWMnOiBbJ3ZkYjEnLCAnZG0tMCddfQogICAgICAgICAgICAgICAgICAgICAgJ2Rpc2tfcGFydGl0aW9uX2RhdGEnOiB7J3ZkYSc6IHsnYXZhaWxfY2FwYWNpdHknOiA1MDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXJ0aXRpb25fdXNhZ2UnOiAxNX19CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICcnJwogICAgICAgIGRlZiBfZ2V0X21vdW50ZWRfZGlza3MoKToKICAgICAgICAgICAgJycnCiAgICAgICAgICAgICAgICBHZXQgbW91bnRlZCBkaXNrcy9wYXJ0aXRpb25zIGZyb20gL3Byb2MvbW91bnRzLgogICAgICAgICAgICAgICAgQHJldHVybjogcGFydGl0aW9uOnRhcmdldCBkaWN0OiB7J3ZkYTEnOiAnLycsICdkbS0wJzogJy9tbnQnfQogICAgICAgICAgICAnJycKICAgICAgICAgICAgd2l0aCBvcGVuKCcvcHJvYy9tb3VudHMnLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICBtb3VudHMgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgICAgIG1vdW50ZWRfZGlza3MgPSB7fQogICAgICAgICAgICBmb3IgbW91bnQgaW4gbW91bnRzOgogICAgICAgICAgICAgICAgaWYgbW91bnQuc3RhcnRzd2l0aCgnL2Rldi8nKToKICAgICAgICAgICAgICAgICAgICBtb3VudCA9IG1vdW50LnNwbGl0KCkKICAgICAgICAgICAgICAgICAgICBwYXJ0aXRpb24gPSBvcy5wYXRoLnJlYWxwYXRoKG1vdW50WzBdKS5yc3BsaXQoJy8nKVstMV0KICAgICAgICAgICAgICAgICAgICB0YXJnZXQgPSBtb3VudFsxXQogICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0aXRpb24gbm90IGluIG1vdW50ZWRfZGlza3MgYW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldCBub3QgaW4gbW91bnRlZF9kaXNrcy52YWx1ZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciAodGFyZ2V0ID09ICcvJyBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcvJyBub3QgaW4gbW91bnRlZF9kaXNrcy52YWx1ZXMoKSkpOgogICAgICAgICAgICAgICAgICAgICAgICBtb3VudGVkX2Rpc2tzW3BhcnRpdGlvbl0gPSB0YXJnZXQKICAgICAgICAgICAgcmV0dXJuIG1vdW50ZWRfZGlza3MKCiAgICAgICAgZGVmIF9nZXRfZnNfaW5mbyhwYXRoKToKICAgICAgICAgICAgIiIiR2V0IGZyZWUvdXNlZC90b3RhbCBzcGFjZSBpbmZvIGZvciBhIGZpbGVzeXN0ZW0KCiAgICAgICAgICAgIDpwYXJhbSBwYXRoOiBBbnkgZGlyZW50IG9uIHRoZSBmaWxlc3lzdGVtCiAgICAgICAgICAgIDpyZXR1cm5zOiBBIGRpY3QgY29udGFpbmluZzoKICAgICAgICAgICAgICAgICAgICAgOmZyZWU6IEhvdyBtdWNoIHNwYWNlIGlzIGZyZWUgKGluIGJ5dGVzKQogICAgICAgICAgICAgICAgICAgICA6dXNlZDogSG93IG11Y2ggc3BhY2UgaXMgdXNlZCAoaW4gYnl0ZXMpCiAgICAgICAgICAgICAgICAgICAgIDp0b3RhbDogSG93IGJpZyB0aGUgZmlsZXN5c3RlbSBpcyAoaW4gYnl0ZXMpCiAgICAgICAgICAgICIiIgogICAgICAgICAgICBoZGRpbmZvID0gb3Muc3RhdHZmcyhwYXRoKQogICAgICAgICAgICB0b3RhbCA9IGhkZGluZm8uZl9mcnNpemUgKiBoZGRpbmZvLmZfYmxvY2tzCiAgICAgICAgICAgIGZyZWUgPSBoZGRpbmZvLmZfZnJzaXplICogaGRkaW5mby5mX2JhdmFpbAogICAgICAgICAgICB1c2VkID0gaGRkaW5mby5mX2Zyc2l6ZSAqIChoZGRpbmZvLmZfYmxvY2tzIC0gaGRkaW5mby5mX2JmcmVlKQogICAgICAgICAgICByZXR1cm4geyd0b3RhbCc6IGZsb2F0KHRvdGFsKSAvIDEwMjQgLyAxMDI0LAogICAgICAgICAgICAgICAgICAgICdmcmVlJzogZmxvYXQoZnJlZSkgLyAxMDI0IC8gMTAyNCwKICAgICAgICAgICAgICAgICAgICAndXNlZCc6IGZsb2F0KHVzZWQpIC8gMTAyNCAvIDEwMjR9CgogICAgICAgIGRlZiBfZ2V0X3BhdGl0aW9uX2luZm8oZGlza3MsIHRvdGFsX2Rpc2tfaW5mbyk6CiAgICAgICAgICAgIHBhcnRpdGlvbnMgPSB7J3N5cyc6IFtdLCAnbG9naWMnOiBbXX0KICAgICAgICAgICAgZm9yIHBhcnRpdGlvbiwgdGFyZ2V0IGluIGRpc2tzLml0ZXJpdGVtcygpOgogICAgICAgICAgICAgICAgZnNfaW5mbyA9IF9nZXRfZnNfaW5mbyh0YXJnZXQpCiAgICAgICAgICAgICAgICBmcmVlID0gZnNfaW5mb1snZnJlZSddCiAgICAgICAgICAgICAgICB1c2VkID0gZnNfaW5mb1sndXNlZCddCiAgICAgICAgICAgICAgICB0b3RhbCA9IGZzX2luZm9bJ3RvdGFsJ10KICAgICAgICAgICAgICAgIHVzYWdlID0gcm91bmQodXNlZCAvIHRvdGFsICogMTAwLCAyKQogICAgICAgICAgICAgICAgdG90YWxfZGlza19pbmZvWydkaXNrX3BhcnRpdGlvbl9kYXRhJ11bcGFydGl0aW9uXSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdmFpbF9jYXBhY2l0eSc6IGZyZWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGFydGl0aW9uX3VzYWdlJzogdXNhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdG90YWxfZGlza19pbmZvWyd1c2VkX2Rpc2snXSArPSB1c2VkCiAgICAgICAgICAgICAgICB0b3RhbF9kaXNrX2luZm9bJ2F2YWlsX2Rpc2snXSArPSBmcmVlCiAgICAgICAgICAgICAgICBpZiB0YXJnZXQgPT0gJy8nOgogICAgICAgICAgICAgICAgICAgIHBhcnRpdGlvbnNbJ3N5cyddLmFwcGVuZChwYXJ0aXRpb24pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHBhcnRpdGlvbnNbJ2xvZ2ljJ10uYXBwZW5kKHBhcnRpdGlvbikKCiAgICAgICAgICAgICMgTk9URShoenlhbmd0ayk6IGhlcmUgdG8gc3RvcmUgYWxsIHRoZSBwYXJ0aXRpb24gbmFtZXMKICAgICAgICAgICAgdG90YWxfZGlza19pbmZvWydkaXNrX3BhcnRpdGlvbl9pbmZvJ10gPSBwYXJ0aXRpb25zCgogICAgICAgIGRlZiBfZ2V0X2Rpc2tfZGF0YV9ieV9wcm9jKGRpc2tzLCB0b3RhbF9kaXNrX2luZm8pOgogICAgICAgICAgICAnJycKICAgICAgICAgICAgICAgIEdldCBkaXNrcyBpbmZvcyBmcm9tIC9wcm9jL2Rpc2tzdGF0cywgbGlrZToKICAgICAgICAgICAgICAgICAgICByZWFkL3dyaXRlIGRhdGFzKEtCKSwKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0IHRpbWVzKGNvdW50IHRpbWUpLAogICAgICAgICAgICAgICAgICAgIHJlYWQvd3JpdGUgcGFpZCB0aW1lKG1zKSBhbmQgc28gb24uCiAgICAgICAgICAgICAgICBBbmQgc2V0IHRoZSBkYXRhcyBpbnRvIHRvdGFsX2Rpc2tfaW5mbyBkaWN0LgogICAgICAgICAgICAnJycKICAgICAgICAgICAgcGFydGl0aW9ucyA9IGRpc2tzLmtleXMoKQogICAgICAgICAgICB3aXRoIG9wZW4oJy9wcm9jL2Rpc2tzdGF0cycpIGFzIGRpc2tzdGF0czoKICAgICAgICAgICAgICAgIGRpc2tfZGF0YXMgPSBkaXNrc3RhdHMucmVhZGxpbmVzKCkKICAgICAgICAgICAgZm9yIGRpc2tfZGF0YSBpbiBkaXNrX2RhdGFzOgogICAgICAgICAgICAgICAgZGF0YXMgPSBkaXNrX2RhdGEuc3BsaXQoKQogICAgICAgICAgICAgICAgaWYgZGF0YXNbMl0gaW4gcGFydGl0aW9uczoKICAgICAgICAgICAgICAgICAgICB0b3RhbF9kaXNrX2luZm9bJ2Rpc2tfcmVhZF9yZXF1ZXN0J10gKz0gbG9uZyhkYXRhc1szXSkKICAgICAgICAgICAgICAgICAgICB0b3RhbF9kaXNrX2luZm9bJ2Rpc2tfd3JpdGVfcmVxdWVzdCddICs9IGxvbmcoZGF0YXNbN10pCiAgICAgICAgICAgICAgICAgICAgdG90YWxfZGlza19pbmZvWydkaXNrX3JlYWQnXSArPSBsb25nKGRhdGFzWzVdKSAvIDIKICAgICAgICAgICAgICAgICAgICB0b3RhbF9kaXNrX2luZm9bJ2Rpc2tfd3JpdGUnXSArPSBsb25nKGRhdGFzWzldKSAvIDIKICAgICAgICAgICAgICAgICAgICB0b3RhbF9kaXNrX2luZm9bJ2Rpc2tfcmVhZF9kZWxheSddICs9IGxvbmcoZGF0YXNbNl0pCiAgICAgICAgICAgICAgICAgICAgdG90YWxfZGlza19pbmZvWydkaXNrX3dyaXRlX2RlbGF5J10gKz0gbG9uZyhkYXRhc1sxMF0pCgogICAgICAgIGRpc2tzID0gX2dldF9tb3VudGVkX2Rpc2tzKCkKICAgICAgICB0b3RhbF9kaXNrX2luZm8gPSB7CiAgICAgICAgICAgICdkaXNrX3JlYWRfcmVxdWVzdCc6IDAsCiAgICAgICAgICAgICdkaXNrX3dyaXRlX3JlcXVlc3QnOiAwLAogICAgICAgICAgICAnZGlza19yZWFkJzogMCwKICAgICAgICAgICAgJ2Rpc2tfd3JpdGUnOiAwLAogICAgICAgICAgICAnZGlza19yZWFkX2RlbGF5JzogMCwKICAgICAgICAgICAgJ2Rpc2tfd3JpdGVfZGVsYXknOiAwLAogICAgICAgICAgICAndXNlZF9kaXNrJzogMCwKICAgICAgICAgICAgJ2F2YWlsX2Rpc2snOiAwLAogICAgICAgICAgICAnZGlza19wYXJ0aXRpb25faW5mbyc6IHt9LAogICAgICAgICAgICAnZGlza19wYXJ0aXRpb25fZGF0YSc6IHt9CiAgICAgICAgfQoKICAgICAgICBfZ2V0X3BhdGl0aW9uX2luZm8oZGlza3MsIHRvdGFsX2Rpc2tfaW5mbykKICAgICAgICBfZ2V0X2Rpc2tfZGF0YV9ieV9wcm9jKGRpc2tzLCB0b3RhbF9kaXNrX2luZm8pCiAgICAgICAgcmV0dXJuIHRvdGFsX2Rpc2tfaW5mbwoKICAgIGRlZiBfZ2V0X2Rpc2tfdXNhZ2VfcmF0ZV9kaWN0KHNlbGYpOgogICAgICAgICcnJwogICAgICAgICAgICBBc3NlbWJsZSBhbGwgdGhlIGRhdGFzIGNvbGxlY3RlZCBmcm9tIF9nZXRfZGlza19kYXRhKCkuCiAgICAgICAgICAgIEByZXR1cm46IHsKICAgICAgICAgICAgICAgICAgICAgICdkaXNrX3JlYWRfcmVxdWVzdCc6IDAuMCwgJ2Rpc2tfd3JpdGVfcmF0ZSc6IDAuMCwKICAgICAgICAgICAgICAgICAgICAgICdkaXNrX3dyaXRlX2RlbGF5JzogMC4wLCAnZGlza19yZWFkX2RlbGF5JzogMC4wLAogICAgICAgICAgICAgICAgICAgICAgJ2Rpc2tfcmVhZF9yYXRlJzogMC4wLCAndXNlZF9kaXNrJzogMCwKICAgICAgICAgICAgICAgICAgICAgICdkaXNrX3dyaXRlX3JlcXVlc3QnOiAwLCAnZGlza19wYXJ0aXRpb25faW5mbyc6IFsndmRhMSddLAogICAgICAgICAgICAgICAgICAgICAgJ2Rpc2tfcGFydGl0aW9uX2RhdGEnOiB7J3ZkYSc6IHsnYXZhaWxfY2FwYWNpdHknOiA1MDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwYXJ0aXRpb25fdXNhZ2UnOiAxNX19CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAnJycKICAgICAgICBnbG9iYWwgVEVNUF9EQVRBCiAgICAgICAgbm93X2Rpc2tfZGF0YSA9IHNlbGYuX2dldF9kaXNrX2RhdGEoKQogICAgICAgIHdyaXRlX3JlcXVlc3RfcGVyaW9kX3RpbWUgPSBub3dfZGlza19kYXRhWydkaXNrX3dyaXRlX3JlcXVlc3QnXSBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gVEVNUF9EQVRBWydkaXNrX3dyaXRlX3JlcXVlc3QnXQogICAgICAgIHJlYWRfcmVxdWVzdF9wZXJpb2RfdGltZSA9IG5vd19kaXNrX2RhdGFbJ2Rpc2tfcmVhZF9yZXF1ZXN0J10gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtIFRFTVBfREFUQVsnZGlza19yZWFkX3JlcXVlc3QnXQogICAgICAgIGlmIHdyaXRlX3JlcXVlc3RfcGVyaW9kX3RpbWUgPT0gMDoKICAgICAgICAgICAgd3JpdGVfcmVxdWVzdF9wZXJpb2RfdGltZSA9IDEKICAgICAgICBpZiByZWFkX3JlcXVlc3RfcGVyaW9kX3RpbWUgPT0gMDoKICAgICAgICAgICAgcmVhZF9yZXF1ZXN0X3BlcmlvZF90aW1lID0gMQoKICAgICAgICBkaXNrX3dyaXRlX3JhdGUgPSBmbG9hdChub3dfZGlza19kYXRhWydkaXNrX3dyaXRlJ10gLSBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVEVNUF9EQVRBWydkaXNrX3dyaXRlJ10pIC8gUEVSSU9EX1RJTUUKICAgICAgICBkaXNrX3JlYWRfcmF0ZSA9IGZsb2F0KG5vd19kaXNrX2RhdGFbJ2Rpc2tfcmVhZCddIC0gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVEVNUF9EQVRBWydkaXNrX3JlYWQnXSkgLyBQRVJJT0RfVElNRQogICAgICAgIGRpc2tfd3JpdGVfcmVxdWVzdCA9IGZsb2F0KG5vd19kaXNrX2RhdGFbJ2Rpc2tfd3JpdGVfcmVxdWVzdCddIC0gXAogICAgICAgICAgICAgICAgVEVNUF9EQVRBWydkaXNrX3dyaXRlX3JlcXVlc3QnXSkgLyBQRVJJT0RfVElNRQogICAgICAgIGRpc2tfcmVhZF9yZXF1ZXN0ID0gZmxvYXQobm93X2Rpc2tfZGF0YVsnZGlza19yZWFkX3JlcXVlc3QnXSAtIFwKICAgICAgICAgICAgICAgIFRFTVBfREFUQVsnZGlza19yZWFkX3JlcXVlc3QnXSkgLyBQRVJJT0RfVElNRQogICAgICAgIGRpc2tfd3JpdGVfZGVsYXkgPSBmbG9hdChub3dfZGlza19kYXRhWydkaXNrX3dyaXRlX2RlbGF5J10gLSBcCiAgICAgICAgICAgIFRFTVBfREFUQVsnZGlza193cml0ZV9kZWxheSddKSAvIGZsb2F0KHdyaXRlX3JlcXVlc3RfcGVyaW9kX3RpbWUpCiAgICAgICAgZGlza19yZWFkX2RlbGF5ID0gZmxvYXQobm93X2Rpc2tfZGF0YVsnZGlza19yZWFkX2RlbGF5J10gLSBcCiAgICAgICAgICAgIFRFTVBfREFUQVsnZGlza19yZWFkX2RlbGF5J10pIC8gZmxvYXQocmVhZF9yZXF1ZXN0X3BlcmlvZF90aW1lKQogICAgICAgIGlmIGRpc2tfd3JpdGVfcmF0ZSA8IDAgb3IgZGlza19yZWFkX3JhdGUgPCAwIFwKICAgICAgICAgICAgICAgICAgICAgICAgb3IgZGlza193cml0ZV9yZXF1ZXN0IDwgMCBvciBkaXNrX3JlYWRfcmVxdWVzdCA8IDAgXAogICAgICAgICAgICAgICAgICAgICAgICBvciBkaXNrX3dyaXRlX2RlbGF5IDwgMCBvciBkaXNrX3JlYWRfZGVsYXkgPCAwOgogICAgICAgICAgICBkaXNrX3dyaXRlX3JhdGUgPSAwLjAKICAgICAgICAgICAgZGlza19yZWFkX3JhdGUgPSAwLjAKICAgICAgICAgICAgZGlza193cml0ZV9yZXF1ZXN0ID0gMC4wCiAgICAgICAgICAgIGRpc2tfcmVhZF9yZXF1ZXN0ID0gMC4wCiAgICAgICAgICAgIGRpc2tfd3JpdGVfZGVsYXkgPSAwLjAKICAgICAgICAgICAgZGlza19yZWFkX2RlbGF5ID0gMC4wCgogICAgICAgIGRpc2tfdXNhZ2VfZGljdCA9IHsKICAgICAgICAgICAgICAgICd1c2VkX2Rpc2snOiBub3dfZGlza19kYXRhWyd1c2VkX2Rpc2snXSwKICAgICAgICAgICAgICAgICdkaXNrX3dyaXRlX3JhdGUnOiBkaXNrX3dyaXRlX3JhdGUsCiAgICAgICAgICAgICAgICAnZGlza19yZWFkX3JhdGUnOiBkaXNrX3JlYWRfcmF0ZSwKICAgICAgICAgICAgICAgICdkaXNrX3dyaXRlX3JlcXVlc3QnOiBkaXNrX3dyaXRlX3JlcXVlc3QsCiAgICAgICAgICAgICAgICAnZGlza19yZWFkX3JlcXVlc3QnOiBkaXNrX3JlYWRfcmVxdWVzdCwKICAgICAgICAgICAgICAgICdkaXNrX3dyaXRlX2RlbGF5JzogZGlza193cml0ZV9kZWxheSwKICAgICAgICAgICAgICAgICdkaXNrX3JlYWRfZGVsYXknOiBkaXNrX3JlYWRfZGVsYXksCiAgICAgICAgICAgICAgICAnZGlza19wYXJ0aXRpb25faW5mbyc6IG5vd19kaXNrX2RhdGFbJ2Rpc2tfcGFydGl0aW9uX2luZm8nXSwKICAgICAgICAgICAgICAgICdkaXNrX3BhcnRpdGlvbl9kYXRhJzogbm93X2Rpc2tfZGF0YVsnZGlza19wYXJ0aXRpb25fZGF0YSddCiAgICAgICAgfQoKICAgICAgICAjIHdoZW4gcGFydGl0aW9uIGluZm8gY2hhbmdlZCwgbm90aWZ5IHBsYXRmb3JtIHdpdGggbmV3IHBhcnRpdGlvbiBpbmZvCiAgICAgICAgbGFzdF9wYXJ0aXRpb25faW5mbyA9IHt9CiAgICAgICAgaXNfc3VjY2VzcyA9IFRydWUKICAgICAgICBpZiBFTkFCTEVfUEFSVElUSU9OX01PTklUT1IgYW5kIFwKICAgICAgICAgICAgICAgIG5vd19kaXNrX2RhdGEuZ2V0KCdkaXNrX3BhcnRpdGlvbl9pbmZvJykgXAogICAgICAgICAgICAgICAgIT0gVEVNUF9EQVRBLmdldCgnZGlza19wYXJ0aXRpb25faW5mbycpOgogICAgICAgICAgICBpc19zdWNjZXNzID0gbm90aWZ5X3BsYXRmb3JtX3BhcnRpdGlvbl9jaGFuZ2UoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3dfZGlza19kYXRhLmdldCgnZGlza19wYXJ0aXRpb25faW5mbycsIFtdKSkKICAgICAgICAgICAgaWYgbm90IGlzX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICBsYXN0X3BhcnRpdGlvbl9pbmZvID0gVEVNUF9EQVRBWydkaXNrX3BhcnRpdGlvbl9pbmZvJ10KCiAgICAgICAgZm9yIGtleSBpbiBub3dfZGlza19kYXRhLmtleXMoKToKICAgICAgICAgICAgaWYga2V5IGluIFRFTVBfREFUQToKICAgICAgICAgICAgICAgIFRFTVBfREFUQVtrZXldID0gbm93X2Rpc2tfZGF0YVtrZXldCgogICAgICAgICMgRklYTUUoaHp5YW5ndGspOiBoZXJlIGFkZCBmb3IgZG9uYHQgcmVjb3JkIHBhcnRpdGlvbiBpbmZvIGludG8gdGVtcC4KICAgICAgICAjIFRvIGRvIHRoaXMgd2hlbiBwYXJ0aXRpb24gbW9uaXRvciBlbmFibGUsIHBhcnRpdGlvbiBjaGFuZ2Ugd2lsbCBvY2N1cgogICAgICAgIGlmIG5vdCBFTkFCTEVfUEFSVElUSU9OX01PTklUT1Igb3Igbm90IGlzX3N1Y2Nlc3M6CiAgICAgICAgICAgIFRFTVBfREFUQVsnZGlza19wYXJ0aXRpb25faW5mbyddID0gbGFzdF9wYXJ0aXRpb25faW5mbwoKICAgICAgICByZXR1cm4gZGlza191c2FnZV9kaWN0CgogICAgZGVmIF9nZXRfbmV0d29ya19mbG93X2RhdGEoc2VsZik6CiAgICAgICAgJycnCiAgICAgICAgICAgIEdldCBuZXR3b3JrIGZsb3cgZGF0YXMoQnl0ZSkgZnJvbSBuZXR3b3JrIGNhcmQgYnkKICAgICAgICAgICAgY29tbWFuZCAnaWZjb25maWcnLgogICAgICAgICAgICBTcGxpdCB0aGUgZ3JlcCByZXN1bHQgYW5kIGRpdmlkZSBpdCBpbnRvIGxpc3QuCiAgICAgICAgICAgIEByZXR1cm46IFsnMTAuMTIwLjAuMScsICcxMjMnLCAnMTIzJ10KICAgICAgICAnJycKICAgICAgICByZWNlaXZlX2J5dGVzID0gMEwKICAgICAgICB0cmFuc2Zlcl9ieXRlcyA9IDBMCiAgICAgICAgcmVjZWl2ZV9wYWNrYWdlcyA9IDBMCiAgICAgICAgdHJhbnNmZXJfcGFja2FnZXMgPSAwTAogICAgICAgICMgVE9ETyhoenlhbmd0ayk6IFdoZW4gVk0gaGFzIG11bHRpcGxlIG5ldHdvcmsgY2FyZCwgaXQgc2hvdWxkIG1vbml0b3IKICAgICAgICAjICAgICAgICAgICAgICAgICBhbGwgdGhlIGNhcmRzIGJ1dCBub3Qgb25seSBldGgwLgogICAgICAgIHdpdGggb3BlbignL3Byb2MvbmV0L2RldicsICdyJykgYXMgbmV0X2RldjoKICAgICAgICAgICAgbmV0d29ya19saW5lcyA9IG5ldF9kZXYucmVhZGxpbmVzKCkKICAgICAgICBmb3IgbmV0d29ya19saW5lIGluIG5ldHdvcmtfbGluZXM6CiAgICAgICAgICAgIG5ldHdvcmtfZGF0YXMgPSBuZXR3b3JrX2xpbmUucmVwbGFjZSgnOicsICcgJykuc3BsaXQoKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBuZXR3b3JrX2RhdGFzWzBdIGluIE5FVF9DQVJEX0xJU1Q6CiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZV9ieXRlcyArPSBsb25nKG5ldHdvcmtfZGF0YXNbMV0pCiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZV9wYWNrYWdlcyArPSBsb25nKG5ldHdvcmtfZGF0YXNbMl0pCiAgICAgICAgICAgICAgICAgICAgdHJhbnNmZXJfYnl0ZXMgKz0gbG9uZyhuZXR3b3JrX2RhdGFzWzldKQogICAgICAgICAgICAgICAgICAgIHRyYW5zZmVyX3BhY2thZ2VzICs9IGxvbmcobmV0d29ya19kYXRhc1sxMF0pCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIHJldHVybiBbcmVjZWl2ZV9ieXRlcywgdHJhbnNmZXJfYnl0ZXNdCgogICAgZGVmIF9nZXRfbmV0d29ya19mbG93X3JhdGVfZGljdChzZWxmKToKICAgICAgICAnJycKICAgICAgICAgICAgQXNzZW1ibGUgZGljdCBkYXRhcyBjb2xsZWN0IGZyb20gX2dldF9uZXR3b3JrX2Zsb3dfZGF0YSgpCiAgICAgICAgICAgIGZvciBuZXR3b3JrIGZsb3cgcmF0ZSBpbiA2MHMuCiAgICAgICAgICAgIFNldCBuZXR3b3JrIGZsb3cgZGF0YXMgdG8gVEVNUF9EQVRBLgogICAgICAgICAgICBAcmV0dXJuOiB7CiAgICAgICAgICAgICAgICAgICAgICAnaXAnOiAnMTAuMTIwLjAuMScsCiAgICAgICAgICAgICAgICAgICAgICAncmVjZWl2ZV9yYXRlJzogMC4wLAogICAgICAgICAgICAgICAgICAgICAgJ3RyYW5zZmVyX3JhdGUnOiAwLjAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgJycnCiAgICAgICAgb2xkX3JlY2VpdmVfYnl0ZXMgPSBURU1QX0RBVEFbJ25ldHdvcmtfcmVjZWl2ZV9ieXRlcyddCiAgICAgICAgb2xkX3RyYW5zZmVyX2J5dGVzID0gVEVNUF9EQVRBWyduZXR3b3JrX3RyYW5zZmVyX2J5dGVzJ10KICAgICAgICBub3dfcmVjZWl2ZV9ieXRlcywgbm93X3RyYW5zZmVyX2J5dGVzID0gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9nZXRfbmV0d29ya19mbG93X2RhdGEoKQogICAgICAgIHJlY2VpdmVfcmF0ZSA9IGZsb2F0KG5vd19yZWNlaXZlX2J5dGVzIC0gb2xkX3JlY2VpdmVfYnl0ZXMpIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvIDEwMjQgLyBQRVJJT0RfVElNRQogICAgICAgIHRyYW5zZmVyX3JhdGUgPSBmbG9hdChub3dfdHJhbnNmZXJfYnl0ZXMgLSBvbGRfdHJhbnNmZXJfYnl0ZXMpIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvIDEwMjQgLyBQRVJJT0RfVElNRQogICAgICAgIGlmIHJlY2VpdmVfcmF0ZSA8IDAgb3IgdHJhbnNmZXJfcmF0ZSA8IDA6CiAgICAgICAgICAgIHJlY2VpdmVfcmF0ZSA9IDAKICAgICAgICAgICAgdHJhbnNmZXJfcmF0ZSA9IDAKCiAgICAgICAgbmV0d29ya19pbmZvX2RpY3QgPSB7CiAgICAgICAgICAgICAgICAncmVjZWl2ZV9yYXRlJzogcmVjZWl2ZV9yYXRlLAogICAgICAgICAgICAgICAgJ3RyYW5zZmVyX3JhdGUnOiB0cmFuc2Zlcl9yYXRlCiAgICAgICAgfQogICAgICAgIFRFTVBfREFUQVsnbmV0d29ya19yZWNlaXZlX2J5dGVzJ10gPSBub3dfcmVjZWl2ZV9ieXRlcwogICAgICAgIFRFTVBfREFUQVsnbmV0d29ya190cmFuc2Zlcl9ieXRlcyddID0gbm93X3RyYW5zZmVyX2J5dGVzCiAgICAgICAgcmV0dXJuIG5ldHdvcmtfaW5mb19kaWN0CgogICAgZGVmIGdldF9zeXN0ZW1fdXNhZ2VfZGF0YXMoc2VsZik6CiAgICAgICAgJycnCiAgICAgICAgICAgIEdldCBhbGwgc3lzdGVtIGRhdGFzIGFuZCBhc3NlbWJsZSB0aGVtIGludG8gYWxsX3N5c3RlbV91c2FnZV9kaWN0LgogICAgICAgICAgICBUaGUga2V5IG5hbWVzIG9mIGFsbF9zeXN0ZW1fdXNhZ2VfZGljdCBhcmUgdGhlIHNhbWUgYXMgWE1MIHNldHRpbmcuCiAgICAgICAgJycnCiAgICAgICAgY3B1X3VzYWdlID0gc2VsZi5fZ2V0X2NwdV91c2FnZV9kaWN0KCkKICAgICAgICBsb2FkYXZnID0gc2VsZi5fZ2V0X2xvYWRhdmdfZGljdCgpCiAgICAgICAgbWVtb3J5X3VzYWdlID0gc2VsZi5fZ2V0X21lbW9yeV91c2FnZV9kaWN0KCkKICAgICAgICBuZXR3b3JrX3VzYWdlID0gc2VsZi5fZ2V0X25ldHdvcmtfZmxvd19yYXRlX2RpY3QoKQogICAgICAgIGRpc2tfdXNhZ2UgPSBzZWxmLl9nZXRfZGlza191c2FnZV9yYXRlX2RpY3QoKQogICAgICAgIGFsbF9zeXN0ZW1fdXNhZ2VfZGljdCA9IHsKICAgICAgICAgICAgJ2NwdVVzYWdlJzogY3B1X3VzYWdlWydjcHVfdXNhZ2UnXSwKICAgICAgICAgICAgJ21lbVVzYWdlJzogbWVtb3J5X3VzYWdlWyd1c2VkX21lbW9yeSddLAogICAgICAgICAgICAnbmV0d29ya1JlY2VpdmUnOiBuZXR3b3JrX3VzYWdlWydyZWNlaXZlX3JhdGUnXSwKICAgICAgICAgICAgJ25ldHdvcmtUcmFuc2Zlcic6IG5ldHdvcmtfdXNhZ2VbJ3RyYW5zZmVyX3JhdGUnXSwKICAgICAgICAgICAgJ2Rpc2tVc2FnZSc6IGRpc2tfdXNhZ2VbJ3VzZWRfZGlzayddLAogICAgICAgICAgICAnZGlza1dyaXRlUmF0ZSc6IGRpc2tfdXNhZ2VbJ2Rpc2tfd3JpdGVfcmF0ZSddLAogICAgICAgICAgICAnZGlza1JlYWRSYXRlJzogZGlza191c2FnZVsnZGlza19yZWFkX3JhdGUnXSwKICAgICAgICAgICAgJ2Rpc2tXcml0ZVJlcXVlc3QnOiBkaXNrX3VzYWdlWydkaXNrX3dyaXRlX3JlcXVlc3QnXSwKICAgICAgICAgICAgJ2Rpc2tSZWFkUmVxdWVzdCc6IGRpc2tfdXNhZ2VbJ2Rpc2tfcmVhZF9yZXF1ZXN0J10sCiAgICAgICAgICAgICdkaXNrV3JpdGVEZWxheSc6IGRpc2tfdXNhZ2VbJ2Rpc2tfd3JpdGVfZGVsYXknXSwKICAgICAgICAgICAgJ2Rpc2tSZWFkRGVsYXknOiBkaXNrX3VzYWdlWydkaXNrX3JlYWRfZGVsYXknXSwKICAgICAgICAgICAgJ2Rpc2tQYXJ0aXRpb24nOiBbZGlza191c2FnZVsnZGlza19wYXJ0aXRpb25faW5mbyddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNrX3VzYWdlWydkaXNrX3BhcnRpdGlvbl9kYXRhJ11dLAogICAgICAgICAgICAnbG9hZGF2Z181JzogbG9hZGF2Z1snbG9hZGF2Z181J10sCiAgICAgICAgICAgICdtZW1Vc2FnZVJhdGUnOiBtZW1vcnlfdXNhZ2VbJ21lbW9yeV91c2FnZV9yYXRlJ10KICAgICAgICB9CgogICAgICAgIHJldHVybiBhbGxfc3lzdGVtX3VzYWdlX2RpY3QKCgpjbGFzcyBEYXRhRm9ybWF0ZXIob2JqZWN0KToKCiAgICBkZWYgX3NldHRpbmdfcGFyYW1zKHNlbGYsIG1ldHJpY05hbWUsIGRpbWVuc2lvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0aW9uRGltZW5zaW9ucywgc3VtX3ZhbHVlLCB1bml0KToKICAgICAgICAnJycKICAgICAgICAgICAgU2V0dGluZyB0aGUgbWV0cmljIGVsZW1lbnQgcGFyYW1ldGVycyBhbmQgZGF0YXMuCiAgICAgICAgICAgIEByZXR1cm46IGRpY3QKICAgICAgICAnJycKICAgICAgICBtZXRyaWNfZGF0YXMgPSB7CiAgICAgICAgICAgICdtZXRyaWNOYW1lJzogbWV0cmljTmFtZSwKICAgICAgICAgICAgJ2RpbWVuc2lvbnMnOiBkaW1lbnNpb25zLAogICAgICAgICAgICAnYWdncmVnYXRpb25EaW1lbnNpb25zJzogYWdncmVnYXRpb25EaW1lbnNpb25zLAogICAgICAgICAgICAnc3VtJzogc3VtX3ZhbHVlLAogICAgICAgICAgICAnbWF4aW51bSc6IHN1bV92YWx1ZSwKICAgICAgICAgICAgJ21pbmludW0nOiBzdW1fdmFsdWUsCiAgICAgICAgICAgICdzYW1wbGVDb3VudCc6IDEsCiAgICAgICAgICAgICdjcmVhdGVUaW1lJzogbG9uZyh0aW1lLnRpbWUoKSAqIDEwMDApLAogICAgICAgICAgICAndW5pdCc6IHVuaXQKICAgICAgICB9CgogICAgICAgIHJldHVybiBtZXRyaWNfZGF0YXMKCiAgICBkZWYgZm9ybWF0X2RhdGEoc2VsZiwgYWxsX3VzYWdlX2RpY3QsIG1ldGFkYXRhX2RpY3QpOgogICAgICAgICcnJwogICAgICAgICAgICBGb3JtYXQgdGhlIGNvbGxlY3RlZCBkYXRhcyBpbnRvIHJlc3VsdCBhbmQgZGVmaW5lZCBmb3JtYXQ6CiAgICAgICAgICAgIHsibWV0cmljRGF0YXMiOiBbCiAgICAgICAgICAgICAgICAgICAgICAgIHsibWV0cmljTmFtZSI6ICJjcHVVc2FnZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAiZGltZW5zaW9ucyI6ICJpcD0xLjEuMS4xIiwKICAgICAgICAgICAgICAgICAgICAgICAgICJhZ2dyZWdhdGlvbkRpbWVuc2lvbnMiOiAiY2x1c3Rlcj1jMSxlbnY9cHJvZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAic3VtIjogMTAxLAogICAgICAgICAgICAgICAgICAgICAgICAgIm1heGludW0iOiAxMDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAibWluaW51bSI6IDEwMSwKICAgICAgICAgICAgICAgICAgICAgICAgICJzYW1wbGVDb3VudCI6IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAiY3JlYXRlVGltZSI6IDEzNDQzMjkyOTI1NTcsCiAgICAgICAgICAgICAgICAgICAgICAgICAidW5pdCI6IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgfQogICAgICAgICcnJwogICAgICAgIG1ldHJpY19kYXRhcyA9IGRpY3QoKQogICAgICAgIG1ldHJpY19kYXRhc1snbWV0cmljRGF0YXMnXSA9IGxpc3QoKQoKICAgICAgICBpZiBtZXRhZGF0YV9kaWN0WydzZXJ2aWNlJ10gaW4gU0VSVklDRV9MSVNUOgogICAgICAgICAgICAjIGZvciBvcGVuc3RhY2sgcmVzb3VyY2VfaWQgaXMgc3RvcmUgVk0gaXAgKGV0aDApCiAgICAgICAgICAgIGlkZW50aWZ5X2lkID0gZ2V0X3V1aWQoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlkZW50aWZ5X2lkID0gbWV0YWRhdGFfZGljdFsncmVzb3VyY2VfaWQnXQoKICAgICAgICBhZ2dyZWdhdGlvbl9pdGVtcyA9IG1ldGFkYXRhX2RpY3RbJ2FnZ3JlZ2F0aW9uX2l0ZW1zJ10KCiAgICAgICAgIyBSZWFkIFhNTCBzZXR0aW5ncyBhbmQgc2V0IGFnZ3JlZ2F0aW9uIGRpbWVuc2lvbgogICAgICAgICMgaW5mb3MgYW5kIHN0b3JlIG1ldHJpYyBkYXRhcwogICAgICAgIHJvb3QgPSBFbGVtZW50VHJlZS5wYXJzZShYTUxfUEFUSCkKICAgICAgICBzZXJ2aWNlcyA9IHJvb3QuZ2V0aXRlcmF0b3IoInNlcnZpY2UiKQogICAgICAgIGZvciBzZXJ2aWNlIGluIHNlcnZpY2VzOgogICAgICAgICAgICBpZiBzZXJ2aWNlLmF0dHJpYlsnbmFtZSddID09IG1ldGFkYXRhX2RpY3RbJ3NlcnZpY2UnXSBhbmQgXAogICAgICAgICAgICBzZXJ2aWNlLmF0dHJpYlsncmVzb3VyY2VfdHlwZSddID09IG1ldGFkYXRhX2RpY3RbJ3Jlc291cmNlX3R5cGUnXToKICAgICAgICAgICAgICAgICMgTk9URShoenJhbmRkKTogZGVhbCB3aXRoIFJEUyBkaW1lbnNpb25zIHRvIGtlZXAgaXQgdmFsaWQuCiAgICAgICAgICAgICAgICBSRFMgPSBzZXJ2aWNlLmF0dHJpYlsnbmFtZSddID09ICdSRFMnCiAgICAgICAgICAgICAgICBtZXRyaWNzID0gc2VydmljZS5nZXRpdGVyYXRvcignbWV0cmljJykKICAgICAgICAgICAgICAgIGZvciBtZXRyaWMgaW4gbWV0cmljczoKICAgICAgICAgICAgICAgICAgICBtZXRyaWNfdHlwZSA9IG1ldHJpYy5hdHRyaWJbJ25hbWUnXQogICAgICAgICAgICAgICAgICAgIG1ldHJpY191bml0ID0gbWV0cmljLmF0dHJpYlsndW5pdCddCiAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRpb25zID0gbWV0cmljLmdldGl0ZXJhdG9yKCdhZ2dyZWdhdGlvbicpCiAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRpb25EaW1lbnNpb25zID0gJycKICAgICAgICAgICAgICAgICAgICBmb3IgYWdncmVnYXRpb24gaW4gYWdncmVnYXRpb25zOgogICAgICAgICAgICAgICAgICAgICAgICBhZ19uYW1lID0gYWdncmVnYXRpb24uYXR0cmliWyduYW1lJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWdfbmFtZSBpbiBhZ2dyZWdhdGlvbl9pdGVtczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFnZ3JlZ2F0aW9uRGltZW5zaW9ucyAhPSAnJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ2dyZWdhdGlvbkRpbWVuc2lvbnMgKz0gJywnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ2dyZWdhdGlvbkRpbWVuc2lvbnMgKz0gYWdfbmFtZSArICc9JyArIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWdncmVnYXRpb25faXRlbXNbYWdfbmFtZV0uZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgICAgICAgICAgaWYgbWV0cmljX3R5cGUgPT0gJ2Rpc2tQYXJ0aXRpb24nIGFuZCBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVOQUJMRV9QQVJUSVRJT05fTU9OSVRPUjoKICAgICAgICAgICAgICAgICAgICAgICAgcGFydGl0aW9uX2luZm8gPSBhbGxfdXNhZ2VfZGljdFttZXRyaWNfdHlwZV1bMF0KICAgICAgICAgICAgICAgICAgICAgICAgcGFydGl0aW9uX2RhdGFzID0gYWxsX3VzYWdlX2RpY3RbbWV0cmljX3R5cGVdWzFdCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpdGlvbl9zZXR0aW5nID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2F2YWlsX2NhcGFjaXR5JzogWydhdmFpbENhcGFjaXR5JywgJ01lZ2FieXRlcyddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhcnRpdGlvbl91c2FnZSc6IFsncGFydGl0aW9uVXNhZ2UnLCAnUGVyY2VudCddCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHBhcnRpdGlvbl9uYW1lIGluIHBhcnRpdGlvbl9kYXRhczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhcnRpdGlvbl9uYW1lIGluIHBhcnRpdGlvbl9pbmZvWydzeXMnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aXRpb25faWRlbnRpdHkgPSAnc3lzdGVtJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBwYXJ0aXRpb25fbmFtZSBpbiBwYXJ0aXRpb25faW5mb1snbG9naWMnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aXRpb25faWRlbnRpdHkgPSAnbG9naWMnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGZvciBwYXJ0aXRpb24gZGF0YSBkaW1lbnNpb25zIGlzIGxpa2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcGFydGl0aW9uPTEuMS4xLjEjOjojc3lzdGVtIzo6I3ZkYTEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFJEUzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gbWV0YWRhdGFfZGljdFsncmVzb3VyY2VfdHlwZSddIFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgJz0nICsgaWRlbnRpZnlfaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE5PVEUoaHpyYW5kZCk6IE9ubHkgbW9uaXRvciBsb2dpYyBkaXNrIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGZvciBSRFMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFydGl0aW9uX2lkZW50aXR5ID09ICdzeXN0ZW0nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gJ3BhcnRpdGlvbj0nICsgaWRlbnRpZnlfaWQgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIzo6IycgKyBwYXJ0aXRpb25faWRlbnRpdHkgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIzo6IycgKyBwYXJ0aXRpb25fbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHBhcnRpX2RhdGFfbmFtZSBpbiBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGl0aW9uX2RhdGFzW3BhcnRpdGlvbl9uYW1lXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aV9tZXRyaWNfbmFtZSA9IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpdGlvbl9zZXR0aW5nW3BhcnRpX2RhdGFfbmFtZV1bMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aV91bml0ID0gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGl0aW9uX3NldHRpbmdbcGFydGlfZGF0YV9uYW1lXVsxXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpX21ldHJpY19kYXRhID0gXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGl0aW9uX2RhdGFzW3BhcnRpdGlvbl9uYW1lXVtwYXJ0aV9kYXRhX25hbWVdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljX2RhdGEgPSBzZWxmLl9zZXR0aW5nX3BhcmFtcygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGlfbWV0cmljX25hbWUsIGRpbWVuc2lvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFnZ3JlZ2F0aW9uRGltZW5zaW9ucywgcGFydGlfbWV0cmljX2RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpX3VuaXQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljX2RhdGFzWydtZXRyaWNEYXRhcyddLmFwcGVuZChtZXRyaWNfZGF0YSkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1ldHJpY190eXBlICE9ICdkaXNrUGFydGl0aW9uJzoKICAgICAgICAgICAgICAgICAgICAgICAgIyBmb3Igbm9ybWFsIGRhdGEgZGltZW5zaW9ucyBpcyBsaWtlCiAgICAgICAgICAgICAgICAgICAgICAgICMgb3BlbnN0YWNrPTEuMS4xLjEgIG9yICBSRFM9MTIzNDU2Nzg5MAogICAgICAgICAgICAgICAgICAgICAgICBkaW1lbnNpb25zID0gbWV0YWRhdGFfZGljdFsncmVzb3VyY2VfdHlwZSddICsgJz0nICsgXAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkZW50aWZ5X2lkCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldHJpY19kYXRhID0gc2VsZi5fc2V0dGluZ19wYXJhbXMobWV0cmljX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpbWVuc2lvbnMsIGFnZ3JlZ2F0aW9uRGltZW5zaW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsX3VzYWdlX2RpY3RbbWV0cmljX3R5cGVdLCBtZXRyaWNfdW5pdCkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0cmljX2RhdGFzWydtZXRyaWNEYXRhcyddLmFwcGVuZChtZXRyaWNfZGF0YSkKCiAgICAgICAgcmV0dXJuIG1ldHJpY19kYXRhcwoKCmNsYXNzIFNlbmRSZXF1ZXN0KG9iamVjdCk6CiAgICAnJycKICAgICAgICBTZW5kIGRhdGFzIHRvIG1vbml0b3Igc2VydmVyIGJ5IGFjY2Vzc2tleSBhdXRob3JpemF0aW9uLgogICAgJycnCiAgICBkZWYgX19pbml0X18oc2VsZiwgbWV0YWRhdGFfZGljdCwgbWV0cmljX2RhdGFzX2pzb249Tm9uZSwKICAgICAgICAgICAgICAgICByZXF1ZXN0X3VyaT0nL3Jlc3QvVjEvTWV0cmljRGF0YScsCiAgICAgICAgICAgICAgICAgaGVhZGVycz17J0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnfSwKICAgICAgICAgICAgICAgICBodHRwX21ldGhvZD0nUE9TVCcsCiAgICAgICAgICAgICAgICAgc3lzdGVtX3BhcnRpdGlvbnM9Tm9uZSwKICAgICAgICAgICAgICAgICBsb2dpY19wYXJ0aXRpb25zPU5vbmUsCiAgICAgICAgICAgICAgICAgcGFydGlfZGltZW5zaW9uPU5vbmUpOgogICAgICAgIHNlbGYudXJsID0gbWV0YWRhdGFfZGljdFsnbW9uaXRvcldlYlNlcnZlclVybCddCiAgICAgICAgc2VsZi5yZXF1ZXN0X3VyaSA9IHJlcXVlc3RfdXJpCiAgICAgICAgc2VsZi5oZWFkZXJzID0gaGVhZGVycwogICAgICAgIHNlbGYuaHR0cF9tZXRob2QgPSBodHRwX21ldGhvZAogICAgICAgIHNlbGYucHJvamVjdF9pZCA9IG1ldGFkYXRhX2RpY3RbJ29yaV91c2VyJ10KICAgICAgICBzZWxmLm5hbWVfc3BhY2UgPSBtZXRhZGF0YV9kaWN0WydzZXJ2aWNlJ10KICAgICAgICBzZWxmLmFjY2Vzc19rZXkgPSBtZXRhZGF0YV9kaWN0WydhY2Nlc3NLZXknXQogICAgICAgIHNlbGYuYWNjZXNzX3NlY3JldCA9IG1ldGFkYXRhX2RpY3RbJ2FjY2Vzc1NlY3JldCddCiAgICAgICAgc2VsZi5tZXRyaWNfZGF0YXNfanNvbiA9IG1ldHJpY19kYXRhc19qc29uCiAgICAgICAgc2VsZi5zeXN0ZW1fcGFydGl0aW9ucyA9IHN5c3RlbV9wYXJ0aXRpb25zCiAgICAgICAgc2VsZi5sb2dpY19wYXJ0aXRpb25zID0gbG9naWNfcGFydGl0aW9ucwogICAgICAgIHNlbGYucGFydGlfZGltZW5zaW9uID0gcGFydGlfZGltZW5zaW9uCgogICAgZGVmIHNlbmRfcmVxdWVzdF90b19zZXJ2ZXIoc2VsZik6CiAgICAgICAgJycnCiAgICAgICAgICAgIFNlbmQgbW9uaXRvciBkYXRhcyB0byBjb2xsZWN0IHNlcnZlciBieSBQT1NUIHJlcXVlc3QuCiAgICAgICAgJycnCiAgICAgICAgcGFyYW1zX2RpY3QgPSB7CiAgICAgICAgICAgICAgICAnUHJvamVjdElkJzogc2VsZi5wcm9qZWN0X2lkLAogICAgICAgICAgICAgICAgJ05hbWVzcGFjZSc6IHNlbGYubmFtZV9zcGFjZSwKICAgICAgICAgICAgICAgICdBY2Nlc3NLZXknOiBzZWxmLmFjY2Vzc19rZXksCiAgICAgICAgICAgICAgICAnU2lnbmF0dXJlJzogc2VsZi5nZW5lcmF0ZV9zaWduYXR1cmUoKQogICAgICAgIH0KICAgICAgICBpZiBzZWxmLm1ldHJpY19kYXRhc19qc29uICE9IE5vbmU6CiAgICAgICAgICAgIHBhcmFtc19kaWN0WydNZXRyaWNEYXRhc0pzb24nXSA9IHNlbGYubWV0cmljX2RhdGFzX2pzb24KICAgICAgICBpZiBzZWxmLnN5c3RlbV9wYXJ0aXRpb25zICE9IE5vbmU6CiAgICAgICAgICAgIHBhcmFtc19kaWN0WydTeXN0ZW1QYXJ0aXRpb25zJ10gPSBzZWxmLnN5c3RlbV9wYXJ0aXRpb25zCiAgICAgICAgaWYgc2VsZi5sb2dpY19wYXJ0aXRpb25zICE9IE5vbmU6CiAgICAgICAgICAgIHBhcmFtc19kaWN0WydMb2dpY1BhcnRpdGlvbnMnXSA9IHNlbGYubG9naWNfcGFydGl0aW9ucwogICAgICAgIGlmIHNlbGYucGFydGlfZGltZW5zaW9uICE9IE5vbmU6CiAgICAgICAgICAgIHBhcmFtc19kaWN0WydEaW1lbnNpb24nXSA9IHNlbGYucGFydGlfZGltZW5zaW9uCiAgICAgICAgcGFyYW1zID0gdXJsbGliLnVybGVuY29kZShwYXJhbXNfZGljdCkKCiAgICAgICAgaWYgc3RyKHNlbGYudXJsKS5zdGFydHN3aXRoKCdodHRwOi8vJyk6CiAgICAgICAgICAgIHNlbGYudXJsID0gc3RyKHNlbGYudXJsKS5zcGxpdCgiaHR0cDovLyIpWy0xXQogICAgICAgIGNvbm4gPSBodHRwbGliLkhUVFBDb25uZWN0aW9uKHNlbGYudXJsKQogICAgICAgIGNvbm4ucmVxdWVzdChzZWxmLmh0dHBfbWV0aG9kLCBzZWxmLnJlcXVlc3RfdXJpLCBwYXJhbXMsIHNlbGYuaGVhZGVycykKICAgICAgICByZXNwb25zZSA9IGNvbm4uZ2V0cmVzcG9uc2UoKQogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIHJldHVybiByZXNwb25zZQoKICAgIGRlZiBnZW5lcmF0ZV9zdHJpbmdUb1NpZ24oc2VsZik6CiAgICAgICAgJycnCiAgICAgICAgICAgIEdlbmVyYXRlIHN0cmluZ1RvU2lnbiBmb3Igc2lnbmF0dXJlLgogICAgICAgICcnJwogICAgICAgIGNhbm9uaWNhbGl6ZWRfaGVhZGVycyA9ICcnCiAgICAgICAgaWYgc2VsZi5tZXRyaWNfZGF0YXNfanNvbiAhPSBOb25lOgogICAgICAgICAgICBjYW5vbmljYWxpemVkX3Jlc291cmNlcyA9ICgnQWNjZXNzS2V5PSVzJk1ldHJpY0RhdGFzSnNvbj0lcyYnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdOYW1lc3BhY2U9JXMmUHJvamVjdElkPSVzJyAlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChzZWxmLmFjY2Vzc19rZXksIHNlbGYubWV0cmljX2RhdGFzX2pzb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm5hbWVfc3BhY2UsIHNlbGYucHJvamVjdF9pZCkpCiAgICAgICAgZWxpZiBzZWxmLnN5c3RlbV9wYXJ0aXRpb25zICE9IE5vbmU6CiAgICAgICAgICAgIGNhbm9uaWNhbGl6ZWRfcmVzb3VyY2VzID0gKCdBY2Nlc3NLZXk9JXMmRGltZW5zaW9uPSVzJicKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0xvZ2ljUGFydGl0aW9ucz0lcyZOYW1lc3BhY2U9JXMmJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUHJvamVjdElkPSVzJlN5c3RlbVBhcnRpdGlvbnM9JXMnICUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHNlbGYuYWNjZXNzX2tleSwgc2VsZi5wYXJ0aV9kaW1lbnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2ljX3BhcnRpdGlvbnMsIHNlbGYubmFtZV9zcGFjZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvamVjdF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc3lzdGVtX3BhcnRpdGlvbnMpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigpCgogICAgICAgIFN0cmluZ1RvU2lnbiA9ICclc1xuJXNcbiVzXG4lc1xuJyAlIFwKICAgICAgICAgICAgICAgICAgICAgIChzZWxmLmh0dHBfbWV0aG9kLCBzZWxmLnJlcXVlc3RfdXJpLAogICAgICAgICAgICAgICAgICAgICAgIGNhbm9uaWNhbGl6ZWRfaGVhZGVycywgY2Fub25pY2FsaXplZF9yZXNvdXJjZXMpCgogICAgICAgIHJldHVybiBTdHJpbmdUb1NpZ24KCiAgICBkZWYgZ2VuZXJhdGVfc2lnbmF0dXJlKHNlbGYpOgogICAgICAgICcnJwogICAgICAgICAgICBHZW5lcmF0ZSBzaWduYXR1cmUgZm9yIGF1dGhvcml6YXRpb24uCiAgICAgICAgICAgIFVzZSBobWFjIFNIQS0yNTYgdG8gY2FsY3VsYXRlIHNpZ25hdHVyZSBzdHJpbmcgYW5kIGVuY29kZQogICAgICAgICAgICBpbnRvIGJhc2U2NC4KICAgICAgICAgICAgQHJldHVybiBTdHJpbmcKICAgICAgICAnJycKICAgICAgICBzdHJpbmdUb1NpZ24gPSBzZWxmLmdlbmVyYXRlX3N0cmluZ1RvU2lnbigpCiAgICAgICAgaGFzaGVkID0gaG1hYy5uZXcoc3RyKHNlbGYuYWNjZXNzX3NlY3JldCksIHN0cmluZ1RvU2lnbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNobGliLnNoYTI1NikKICAgICAgICBzID0gaGFzaGVkLmRpZ2VzdCgpCiAgICAgICAgc2lnbmF0dXJlID0gcy5lbmNvZGUoJ2Jhc2U2NCcpLnJzdHJpcCgpCiAgICAgICAgcmV0dXJuIHNpZ25hdHVyZQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CgogICAgdHJ5OgogICAgICAgIG1ldGFkYXRhX2RpY3QgPSByZWFkX2luZm9fZmlsZSgpCiAgICAgICAgbWV0YWRhdGFfcmVzdWx0ID0gaGFuZGxlX21ldGFkYXRhKG1ldGFkYXRhX2RpY3QpCiAgICAgICAgdGVtcF9yZXN1bHQgPSByZWFkX3RlbXBfZmlsZSgpCgogICAgICAgIGdldF9zeXN0ZW1fdXNhZ2UgPSBHZXRTeXN0ZW1Vc2FnZSgpCiAgICAgICAgYWxsX3VzYWdlX2RpY3QgPSBnZXRfc3lzdGVtX3VzYWdlLmdldF9zeXN0ZW1fdXNhZ2VfZGF0YXMoKQogICAgICAgIHdyaXRlX3RlbXBfZmlsZSgpCgogICAgICAgIGlmIHRlbXBfcmVzdWx0ID09IFRydWUgYW5kIG1ldGFkYXRhX3Jlc3VsdCA9PSBUcnVlOgogICAgICAgICAgICBtZXRyaWNfZGF0YXMgPSBEYXRhRm9ybWF0ZXIoKS5mb3JtYXRfZGF0YShhbGxfdXNhZ2VfZGljdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGFfZGljdCkKICAgICAgICAgICAgbWV0cmljX2RhdGFzX2pzb24gPSBqc29uLmR1bXBzKG1ldHJpY19kYXRhcykKICAgICAgICAgICAgc2VuZF9yZXF1ZXN0ID0gU2VuZFJlcXVlc3QobWV0YWRhdGFfZGljdCwgbWV0cmljX2RhdGFzX2pzb24pCiAgICAgICAgICAgIHNlbmRfcmVxdWVzdC5zZW5kX3JlcXVlc3RfdG9fc2VydmVyKCkKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcGFzcwo="}, {"path": "/etc/vm_monitor/monitor_settings.xml", "contents": "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHNlcnZpY2VzPgoJPHNlcnZpY2UgbmFtZT0iRERCIiByZXNvdXJjZV90eXBlPSdSRFMnPgoJCTxtZXRyaWMgbmFtZT0iY3B1VXNhZ2UiIHVuaXQ9IlBlcmNlbnQiLz4KCQk8bWV0cmljIG5hbWU9Im1lbVVzYWdlIiB1bml0PSJNZWdhYnl0ZXMiLz4KCQk8bWV0cmljIG5hbWU9Im5ldHdvcmtSZWNlaXZlIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIj4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IkREQihSRFNCZWxvbmdzVG8pIi8+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJSRFNBTEwiLz4KCQk8L21ldHJpYz4KCQk8bWV0cmljIG5hbWU9Im5ldHdvcmtUcmFuc2ZlciIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCI+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJEREIoUkRTQmVsb25nc1RvKSIvPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iUkRTQUxMIi8+CgkJPC9tZXRyaWM+CgkJPG1ldHJpYyBuYW1lPSJkaXNrVXNhZ2UiIHVuaXQ9Ik1lZ2FieXRlcyI+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJEREIoUkRTQmVsb25nc1RvKSIvPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iUkRTQUxMIi8+CgkJPC9tZXRyaWM+CgkJPG1ldHJpYyBuYW1lPSJkaXNrUmVhZFJlcXVlc3QiIHVuaXQ9IkNvdW50L1NlY29uZCI+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJEREIoUkRTQmVsb25nc1RvKSIvPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iUkRTQUxMIi8+CgkJPC9tZXRyaWM+CgkJPG1ldHJpYyBuYW1lPSJkaXNrV3JpdGVSZXF1ZXN0IiB1bml0PSJDb3VudC9TZWNvbmQiPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iRERCKFJEU0JlbG9uZ3NUbykiLz4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IlJEU0FMTCIvPgoJCTwvbWV0cmljPgoJCTxtZXRyaWMgbmFtZT0iZGlza1JlYWRSYXRlIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIj4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IkREQihSRFNCZWxvbmdzVG8pIi8+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJSRFNBTEwiLz4KCQk8L21ldHJpYz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZVJhdGUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iRERCKFJEU0JlbG9uZ3NUbykiLz4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IlJEU0FMTCIvPgoJCTwvbWV0cmljPgoJCTxtZXRyaWMgbmFtZT0iZGlza1JlYWREZWxheSIgdW5pdD0iTWlsbGlzZWNvbmRzL0NvdW50Ij4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IkREQihSRFNCZWxvbmdzVG8pIi8+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJSRFNBTEwiLz4KCQk8L21ldHJpYz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZURlbGF5IiB1bml0PSJNaWxsaXNlY29uZHMvQ291bnQiPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iRERCKFJEU0JlbG9uZ3NUbykiLz4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IlJEU0FMTCIvPgoJCTwvbWV0cmljPgoJCTxtZXRyaWMgbmFtZT0ibWVtVXNhZ2VSYXRlIiB1bml0PSJQZXJjZW50Ii8+Cgk8L3NlcnZpY2U+Cgk8c2VydmljZSBuYW1lPSJEREIiIHJlc291cmNlX3R5cGU9J1NRTFB4eVNlcnZlcic+CgkJPG1ldHJpYyBuYW1lPSJjcHVVc2FnZSIgdW5pdD0iUGVyY2VudCIvPgoJCTxtZXRyaWMgbmFtZT0ibWVtVXNhZ2UiIHVuaXQ9Ik1lZ2FieXRlcyIvPgoJCTxtZXRyaWMgbmFtZT0ibmV0d29ya1JlY2VpdmUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iRERCKFNRTFB4eVNlcnZlckJlbG9uZ3NUbykiLz4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IlNRTFB4eVNlcnZlckFMTCIvPgoJCTwvbWV0cmljPgoJCTxtZXRyaWMgbmFtZT0ibmV0d29ya1RyYW5zZmVyIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIj4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IkREQihTUUxQeHlTZXJ2ZXJCZWxvbmdzVG8pIi8+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJTUUxQeHlTZXJ2ZXJBTEwiLz4KCQk8L21ldHJpYz4KCQk8bWV0cmljIG5hbWU9Im1lbVVzYWdlUmF0ZSIgdW5pdD0iUGVyY2VudCIvPgoJPC9zZXJ2aWNlPgoJPHNlcnZpY2UgbmFtZT0iRERCIiByZXNvdXJjZV90eXBlPSdNYXN0ZXInPgoJCTxtZXRyaWMgbmFtZT0iY3B1VXNhZ2UiIHVuaXQ9IlBlcmNlbnQiLz4KCQk8bWV0cmljIG5hbWU9Im1lbVVzYWdlIiB1bml0PSJNZWdhYnl0ZXMiLz4KCQk8bWV0cmljIG5hbWU9Im1lbVVzYWdlUmF0ZSIgdW5pdD0iUGVyY2VudCIvPgoJCTxtZXRyaWMgbmFtZT0ibmV0d29ya1JlY2VpdmUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9Im5ldHdvcmtUcmFuc2ZlciIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCIvPgoJPC9zZXJ2aWNlPgoJPHNlcnZpY2UgbmFtZT0iUkRTIiByZXNvdXJjZV90eXBlPSdSRFMnPgoJCTxtZXRyaWMgbmFtZT0iY3B1VXNhZ2UiIHVuaXQ9IlBlcmNlbnQiLz4KCQk8bWV0cmljIG5hbWU9Im1lbVVzYWdlIiB1bml0PSJNZWdhYnl0ZXMiLz4KCQk8bWV0cmljIG5hbWU9Im5ldHdvcmtSZWNlaXZlIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIj4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IlJEU0FMTCIvPgoJCTwvbWV0cmljPgoJCTxtZXRyaWMgbmFtZT0ibmV0d29ya1RyYW5zZmVyIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIj4KCQkJPGFnZ3JlZ2F0aW9uIG5hbWU9IlJEU0FMTCIvPgoJCTwvbWV0cmljPgoJCTxtZXRyaWMgbmFtZT0iZGlza1VzYWdlIiB1bml0PSJNZWdhYnl0ZXMiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tSZWFkUmVxdWVzdCIgdW5pdD0iQ291bnQvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrV3JpdGVSZXF1ZXN0IiB1bml0PSJDb3VudC9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tSZWFkUmF0ZSIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCI+CgkJCTxhZ2dyZWdhdGlvbiBuYW1lPSJSRFNBTEwiLz4KCQk8L21ldHJpYz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZVJhdGUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiPgoJCQk8YWdncmVnYXRpb24gbmFtZT0iUkRTQUxMIi8+CgkJPC9tZXRyaWM+CgkJPG1ldHJpYyBuYW1lPSJkaXNrUmVhZERlbGF5IiB1bml0PSJNaWxsaXNlY29uZHMvQ291bnQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZURlbGF5IiB1bml0PSJNaWxsaXNlY29uZHMvQ291bnQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tQYXJ0aXRpb24iIHVuaXQ9ImFsbCBwYXJ0aXRpb25zIGluZm9zIi8+CgkJPG1ldHJpYyBuYW1lPSJtZW1Vc2FnZVJhdGUiIHVuaXQ9IlBlcmNlbnQiLz4KCTwvc2VydmljZT4KCTxzZXJ2aWNlIG5hbWU9Ik5DUyIgcmVzb3VyY2VfdHlwZT0ndm0nPgoJCTxtZXRyaWMgbmFtZT0iY3B1VXNhZ2UiIHVuaXQ9IlBlcmNlbnQiLz4KCQk8bWV0cmljIG5hbWU9Im1lbVVzYWdlIiB1bml0PSJNZWdhYnl0ZXMiLz4KCQk8bWV0cmljIG5hbWU9Im5ldHdvcmtSZWNlaXZlIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJuZXR3b3JrVHJhbnNmZXIiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tVc2FnZSIgdW5pdD0iTWVnYWJ5dGVzIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrUmVhZFJlcXVlc3QiIHVuaXQ9IkNvdW50L1NlY29uZCIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1dyaXRlUmVxdWVzdCIgdW5pdD0iQ291bnQvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrUmVhZFJhdGUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZVJhdGUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tSZWFkRGVsYXkiIHVuaXQ9Ik1pbGxpc2Vjb25kcy9Db3VudCIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1dyaXRlRGVsYXkiIHVuaXQ9Ik1pbGxpc2Vjb25kcy9Db3VudCIvPgoJCTxtZXRyaWMgbmFtZT0ibWVtVXNhZ2VSYXRlIiB1bml0PSJQZXJjZW50Ii8+Cgk8L3NlcnZpY2U+Cgk8c2VydmljZSBuYW1lPSJOUVMiIHJlc291cmNlX3R5cGU9J3ZtJz4KCQk8bWV0cmljIG5hbWU9ImNwdVVzYWdlIiB1bml0PSJQZXJjZW50Ii8+CgkJPG1ldHJpYyBuYW1lPSJtZW1Vc2FnZSIgdW5pdD0iTWVnYWJ5dGVzIi8+CgkJPG1ldHJpYyBuYW1lPSJuZXR3b3JrUmVjZWl2ZSIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCIvPgoJCTxtZXRyaWMgbmFtZT0ibmV0d29ya1RyYW5zZmVyIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrVXNhZ2UiIHVuaXQ9Ik1lZ2FieXRlcyIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1JlYWRSZXF1ZXN0IiB1bml0PSJDb3VudC9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZVJlcXVlc3QiIHVuaXQ9IkNvdW50L1NlY29uZCIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1JlYWRSYXRlIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrV3JpdGVSYXRlIiB1bml0PSJLaWxvYnl0ZXMvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrUmVhZERlbGF5IiB1bml0PSJNaWxsaXNlY29uZHMvQ291bnQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tXcml0ZURlbGF5IiB1bml0PSJNaWxsaXNlY29uZHMvQ291bnQiLz4KCQk8bWV0cmljIG5hbWU9ImxvYWRhdmdfNSIgdW5pdD0iUGVyY2VudCIvPgoJCTxtZXRyaWMgbmFtZT0ibWVtVXNhZ2VSYXRlIiB1bml0PSJQZXJjZW50Ii8+Cgk8L3NlcnZpY2U+Cgk8c2VydmljZSBuYW1lPSJvcGVuc3RhY2siIHJlc291cmNlX3R5cGU9J29wZW5zdGFjayc+CgkJPG1ldHJpYyBuYW1lPSJjcHVVc2FnZSIgdW5pdD0iUGVyY2VudCIvPgoJCTxtZXRyaWMgbmFtZT0ibWVtVXNhZ2UiIHVuaXQ9Ik1lZ2FieXRlcyIvPgoJCTxtZXRyaWMgbmFtZT0ibmV0d29ya1JlY2VpdmUiIHVuaXQ9IktpbG9ieXRlcy9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9Im5ldHdvcmtUcmFuc2ZlciIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1VzYWdlIiB1bml0PSJNZWdhYnl0ZXMiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tSZWFkUmVxdWVzdCIgdW5pdD0iQ291bnQvU2Vjb25kIi8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrV3JpdGVSZXF1ZXN0IiB1bml0PSJDb3VudC9TZWNvbmQiLz4KCQk8bWV0cmljIG5hbWU9ImRpc2tSZWFkUmF0ZSIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1dyaXRlUmF0ZSIgdW5pdD0iS2lsb2J5dGVzL1NlY29uZCIvPgoJCTxtZXRyaWMgbmFtZT0iZGlza1JlYWREZWxheSIgdW5pdD0iTWlsbGlzZWNvbmRzL0NvdW50Ii8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrV3JpdGVEZWxheSIgdW5pdD0iTWlsbGlzZWNvbmRzL0NvdW50Ii8+CgkJPG1ldHJpYyBuYW1lPSJkaXNrUGFydGl0aW9uIiB1bml0PSJhbGwgcGFydGl0aW9ucyBpbmZvcyIvPgoJCTxtZXRyaWMgbmFtZT0ibG9hZGF2Z181IiB1bml0PSJQZXJjZW50Ii8+CgkJPG1ldHJpYyBuYW1lPSJtZW1Vc2FnZVJhdGUiIHVuaXQ9IlBlcmNlbnQiLz4KCTwvc2VydmljZT4KPC9zZXJ2aWNlcz4K"}, {"path": "/etc/cron.d/inject_cron_job", "contents": "IyMjIyMgZm9yIEhBIGhlYXJ0YmVhdCAjIyMjIwojIyMjIyBwZXJpb2Q6IDEwIHNlY3MgIyMjIyMKCiMKKi8xICogKiAqICogcm9vdCBjdXJsIC1YIFBVVCAtZCAic3RhdGU9MSIgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9oZWFydGJlYXQgPiAvZGV2L251bGwgMj4mMQoqLzEgKiAqICogKiByb290IHNsZWVwIDEwOyBjdXJsIC1YIFBVVCAtZCAic3RhdGU9MSIgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9oZWFydGJlYXQgPiAvZGV2L251bGwgMj4mMQoqLzEgKiAqICogKiByb290IHNsZWVwIDIwOyBjdXJsIC1YIFBVVCAtZCAic3RhdGU9MSIgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9oZWFydGJlYXQgPiAvZGV2L251bGwgMj4mMQoqLzEgKiAqICogKiByb290IHNsZWVwIDMwOyBjdXJsIC1YIFBVVCAtZCAic3RhdGU9MSIgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9oZWFydGJlYXQgPiAvZGV2L251bGwgMj4mMQoqLzEgKiAqICogKiByb290IHNsZWVwIDQwOyBjdXJsIC1YIFBVVCAtZCAic3RhdGU9MSIgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9oZWFydGJlYXQgPiAvZGV2L251bGwgMj4mMQoqLzEgKiAqICogKiByb290IHNsZWVwIDUwOyBjdXJsIC1YIFBVVCAtZCAic3RhdGU9MSIgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9oZWFydGJlYXQgPiAvZGV2L251bGwgMj4mMQojCgojIyMjIyBmb3Igdm0gbW9uaXRvciAjIyMjIwojIyMjIyBwZXJpb2Q6IDEgbWludXRlICMjIyMjCgojCiovMSAqICogKiAqIHJvb3Qgc3UgLWMgJ3B5dGhvbiAvZXRjL3ZtX21vbml0b3Ivc2VuZF9tb25pdG9yX2RhdGEucHknID4gL2Rldi9udWxsIDI+JjEKIwoKCg=="}]}